(window.__LOADABLE_LOADED_CHUNKS__=window.__LOADABLE_LOADED_CHUNKS__||[]).push([[111],{Glit:function(e,t,n){"use strict";n.d(t,"b",(function(){return c}));var a=n("QkVN"),r=n.n(a);function o(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var c={description:"",descriptionError:null,isTaggable:!0,link:"",linkError:null,media:null,pinTagIds:[],selectedPinTagId:null,tagError:null,title:"",titleError:null,canvasJson:null,signals:{},userMentionTags:[]};t.a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"PIN_DRAFT_ADD_PIN_ITEM":case"PIN_ITEM_UPDATE_DATA":var n=t.payload.pinItem||{};return s(s(s({},e),n),{},{signals:s(s({},e.signals),n.signals)});case"PIN_ITEM_ADD_PIN_TAG":var a=t.payload.pinTagId;return s(s({},e),{},{pinTagIds:[].concat(o(e.pinTagIds),[a])});case"PIN_ITEM_REMOVE_PIN_TAG":var i=t.payload.pinTagId;return s(s({},e),{},{pinTagIds:e.pinTagIds.filter((function(e){return e!==i}))});case"PIN_ITEM_SET_DESCRIPTION":var u=t.payload.description;return s(s({},e),{},{description:u});case"PIN_ITEM_SET_DESCRIPTION_ERROR":var l=t.payload,d=l.descriptionError,p=l.signals;return s(s({},e),{},{descriptionError:d,signals:s(s({},e.signals),p)});case"PIN_ITEM_SET_IS_TAGGABLE":var f=t.payload.isTaggable;return s(s({},e),{},{isTaggable:f});case"PIN_ITEM_SET_LINK":var g=t.payload.link;return s(s({},e),{},{link:g});case"PIN_ITEM_SET_LINK_ERROR":var m=t.payload,h=m.linkError,v=m.signals;return s(s({},e),{},{linkError:h,signals:s(s({},e.signals),v)});case"PIN_ITEM_SET_MEDIA":var y=t.payload.media,b=!(!y||e.link)||e.isTaggable;return s(s({},e),{},{media:y,isTaggable:(!y||"localVideo"!==y.type)&&b,pinTagIds:[],selectedPinTagId:null,canvasJson:null});case"PIN_ITEM_UPDATE_MEDIA":var I=t.payload.media;return s(s({},e),{},{media:e.media?r()({},e.media,I):null});case"PIN_ITEM_SET_SELECTED_PIN_TAG_ID":var P=t.payload.selectedPinTagId;return s(s({},e),{},{selectedPinTagId:P});case"PIN_ITEM_SET_TAG_ERROR":var S=t.payload.tagError;return s(s({},e),{},{tagError:S});case"PIN_ITEM_SET_TITLE":var M=t.payload.title;return s(s({},e),{},{title:M});case"PIN_ITEM_SET_TITLE_ERROR":var E=t.payload,O=E.titleError,_=E.signals;return s(s({},e),{},{titleError:O,signals:s(s({},e.signals),_)});case"PIN_ITEM_SET_EDITED_IMAGE":var T=t.payload,U=T.editedMedia,w=T.canvasJson;return s(s({},e),{},{media:U,canvasJson:w});default:return e}}},ZQVr:function(e,t,n){"use strict";n.d(t,"a",(function(){return v})),n.d(t,"c",(function(){return y})),n.d(t,"d",(function(){return b})),n.d(t,"b",(function(){return I})),n.d(t,"j",(function(){return S})),n.d(t,"g",(function(){return E})),n.d(t,"h",(function(){return O})),n.d(t,"f",(function(){return _})),n.d(t,"e",(function(){return T})),n.d(t,"i",(function(){return U}));var a=n("1ycI"),r=n("eOdZ"),o=n("zwad");function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],a=!0,r=!1,o=void 0;try{for(var i,u=e[Symbol.iterator]();!(a=(i=u.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(s){r=!0,o=s}finally{try{a||null==u.return||u.return()}finally{if(r)throw o}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}var d=1e3,p=[200,201,204],f=2e3,g=8e3,m=6e4,h=3e5;function v(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:512,n=e.split(";"),a=n[0].split(":")[1],r=n[1].split(",")[1],o=atob(r),i=[],u=0;u<o.length;u+=t){for(var s=o.slice(u,u+t),l=new Array(s.length),c=0;c<s.length;c+=1)l[c]=s.charCodeAt(c);var d=new Uint8Array(l);i.push(d)}return new Blob(i,{type:a})}function y(e){return new Promise((function(t){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="blob",n.onload=function(e){if(200===n.status){var a=n.response,r=new FileReader;r.onloadend=function(){var e="string"==typeof r.result?r.result:"";t(e)},r.readAsDataURL(a)}},n.send()}))}function b(){return r.a.create("VisualLinkBoardResource").callCreate().then((function(e){return e.resource_response.data}))}function I(e){return r.a.create("PinResource",e).callCreate().then((function(e){return e.resource_response.data}))}function P(e,t){var n,a,o=t.onSuccess,i=t.onError,u=t.onProcessingStarted,s=t.resolvedAfterProcessingStarted,l=t.delay,c=void 0===l?f:l,d=!1,p=function(){clearTimeout(a),clearTimeout(n)};!function t(){d||r.a.create("VIPResource",{upload_ids:[e]}).callGet().then((function(r){var l=r.resource_response.data;if(l[e]){var f=l[e],g=f.status,v=f.signature,y=f.failure_code;n||(n=setTimeout((function(){d=!0,i("","registered_timeout")}),m)),a||(a=setTimeout((function(){d=!0,i("","processing_timeout")}),h)),"processing"===g||"registered"===g?"processing"===g?(clearTimeout(n),u?s?(clearTimeout(a),u(v)):(u(v),setTimeout((function(){return t()}),c)):setTimeout((function(){return t()}),c)):setTimeout((function(){return t()}),c):"succeeded"===g?(p(),o(v)):(p(),i("VIP status failure code: ".concat(y),null))}else i("VIP upload ID was not returned",null)})).catch((function(){i("VIP failure with checking status",null)}))}()}function S(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=arguments.length>3?arguments[3]:void 0;return new Promise((function(o,i){r.a.create("VIPResource",{type:t}).callCreate().then((function(r){var u=a||{},s=u.onCancelUpload,l=u.onFailureUpload,c=u.onFinishProcessing,m=u.onFinishUpload,h=u.onProgress,v=u.onStartProcessing,y=u.onStartUpload,b=u.setXhr,I=r.resource_response.data,S=I.upload_id,M=I.upload_url,E=I.upload_parameters,O=new Date;y&&y(S);var _=function(e,t){l&&l(S,e,t),i({isError:!0,uploadId:S})},T=new XMLHttpRequest;T.open("POST",M,!0),T.onabort=function(){s&&s(S),i({isError:!1,uploadId:S})},T.onload=function(){if(p.includes(T.status)){var e=new Date,a=(e-O)/d;if(m){var r=T.getResponseHeader("x-amz-request-id"),i=T.getResponseHeader("x-amz-id-2");m({amzId2:i,amzRequestId:r,statusCode:T.status,uploadId:S,uploadTime:a})}P(S,{onProcessingStarted:function(e){return v&&v(S,e),n?o({signature:e,uploadId:S}):void 0},delay:t.includes("image")?f:g,onError:_,onSuccess:function(t){var n=(new Date-e)/d;return c&&c(S,n,t,a),o({signature:t,uploadId:S})},resolvedAfterProcessingStarted:n})}else _("XHR failure status code: ".concat(T.status),null)},T.onerror=function(){T.abort()},h&&(T.upload.onprogress=h),b&&b(T);var U=new FormData;Object.keys(E).forEach((function(e){U.append(e,E[e])})),U.append("file",e),T.send(U)})).catch((function(e){i({isError:!0})}))}))}function M(e){return new Promise((function(t,n){var r=new FormData;r.append("img",e);var i=new XMLHttpRequest;i.open("POST",o.a.absolutify("/upload-image/"),!0),i.setRequestHeader("x-CSRFToken",a.default.getCSRFToken()),i.onload=function(){if(200===i.status){var e=JSON.parse(i.responseText);e.success?t(e):n(new Error(e.error))}else 413===i.status?n(new Error("Oops! Something went wrong while uploading your image. Try uploading a smaller image.")):n(new Error("Oops! Something went wrong while uploading your image (Status code ".concat(i.status,")")))},i.send(r)}))}function E(e){return"string"==typeof e?e.startsWith("data")?M(v(e)):y(e).then((function(e){return M(v(e))})):M(e)}function O(e){return E(e).then((function(e){return new Promise((function(t,n){var a=e.image_url;r.a.create("ScheduledPinResource",{image_url:a,method:"upload"}).callCreate().then((function(e){var n=e.resource_response.data.image_signature;t(n)})).catch((function(){n(new Error("Cannot schedule the Pin."))}))}))})).catch((function(e){throw e}))}function _(e){var t=e.filter((function(e){return!!e.media}));return Promise.all(t.map((function(e){return E(e.media&&e.media.src||"")}))).then((function(e){var t=e.map((function(e){return e.image_url}));return Promise.all([r.a.create("CarouselImageUploaderResource",{image_urls:t}).callUpdate(),t])})).then((function(e){var n=l(e,2),a=n[0],r=n[1],o=a.resource_response.data,i=t.findIndex((function(e,t){return!!o[t].image_signature})),s=(t.find((function(e){return!!e.description}))||{}).description,c=(t.find((function(e){return!!e.link}))||{}).link;return{metadata:{description:s||"",title:(t.find((function(e){return!!e.title}))||{}).title||"",link:c||"",imageSignature:o[i].image_signature||"",image_url:r[0]},slots:t.map((function(e,t){var n=o[t],a=e.description,r=e.title,i=e.link;return u(u({},n),{},{title:r,description:a,link:i})}))}})).catch((function(e){throw e}))}function T(e,t,n,a){return new Promise((function(o,i){r.a.create("VIPEditResource",u({type:t,video_signature:e},n)).callCreate().then((function(e){var t=a||{},n=t.onStartEdits,r=t.onFinishEdits,u=e.resource_response.data.tracking_id,s=new Date;n&&n(u),P(u,{delay:g,onError:function(e){return i(e)},onProcessingStarted:function(e){return o({signature:e,uploadId:u})},onSuccess:function(e){var t=(new Date-s)/d;r&&r(u,t,e),o({signature:e,uploadId:u})},resolvedAfterProcessingStarted:!0})})).catch((function(){i()}))}))}function U(e,t,n){return"string"==typeof e?e.startsWith("data")?S(v(e),t,!1,n):y(e).then((function(e){return S(v(e),t,!1,n)})):S(e,t,!1,n)}},wId3:function(e,t,n){"use strict";n.d(t,"a",(function(){return U}));var a=n("eOdZ");function r(e,t,n,a,r,o,i){try{var u=e[o](i),s=u.value}catch(l){return void n(l)}u.done?t(s):Promise.resolve(s).then(a,r)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(a,o){var i=e.apply(t,n);function u(e){r(i,a,o,u,s,"next",e)}function s(e){r(i,a,o,u,s,"throw",e)}u(void 0)}))}}var i=[200,201,204],u=1e3;function s(){return(s=o(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a.a.create("VIPResource",{upload_ids:t}).callGet();case 3:return n=e.sent,r=n.resource_response.data,e.abrupt("return",t.reduce((function(e,t){return e[t]={failureCode:r[t].failure_code,signature:r[t].signature,status:r[t].status},e}),{}));case 8:throw e.prev=8,e.t0=e.catch(0),e.t0;case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}function l(e,t,n,a){return c.apply(this,arguments)}function c(){return(c=o(regeneratorRuntime.mark((function e(t,n,r,o){var s,l,c,d,p,f,g,m,h,v,y,b;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=o.onFailure,l=o.onFinishUpload,c=o.onStartUpload,d=o.onUploadProgress,e.prev=1,e.next=4,a.a.create("VIPResource",{type:r}).callCreate();case 4:return p=e.sent,f=p.resource_response.data,g=f.upload_id,m=f.upload_parameters,h=f.upload_url,c&&c(g),v=new Date,(y=new XMLHttpRequest).open("POST",h,!0),y.onload=function(){if(i.includes(y.status)){if(l){var e=(new Date-v)/u,t=y.getResponseHeader("x-amz-request-id"),a=y.getResponseHeader("x-amz-id-2");l(g,{amzId2:a,amzRequestId:t,uploadTimeSec:e,statusCode:y.status})}}else{var r="image"===n?1:8;s(g,"Failed to upload the media with XHR status code: ".concat(y.status),r,!0)}},y.onerror=function(){s(g,"Failed to upload the media","image"===n?1:8,!0)},d&&(y.upload.onprogress=function(e){d(Math.round(e.loaded/e.total*100))}),b=new FormData,Object.keys(m).forEach((function(e){b.append(e,m[e])})),b.append("file",t),y.send(b),e.abrupt("return",{uploadId:g,xhr:y});case 20:throw e.prev=20,e.t0=e.catch(1),e.t0;case 23:case"end":return e.stop()}}),e,null,[[1,20]])})))).apply(this,arguments)}var d=n("ZQVr");function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=y(e);if(t){var r=y(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return h(this,n)}}function h(e,t){return!t||"object"!==p(t)&&"function"!=typeof t?v(e):t}function v(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function I(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var P=["webImage","webVideo"],S=function e(t){var n=this;b(this,e),I(this,"upload",(function(){})),I(this,"onFailure",(function(e,t,a,r){r&&n.numAttempts<n.maxUploadAttempts?n.upload():(n.status="failed",n.callbackHandlers.onFailure(e,t,a))})),I(this,"onFinishProcessing",(function(e,t){n.signature=t.signature,n.callbackHandlers.onFinishProcessing&&n.callbackHandlers.onFinishProcessing(e,t)})),I(this,"onFinishUpload",(function(){var e;(n.status="uploaded",n.callbackHandlers.onFinishUpload)&&(e=n.callbackHandlers).onFinishUpload.apply(e,arguments)})),I(this,"onStartProcessing",(function(e,t){n.signature=t.signature,n.callbackHandlers.onStartProcessing&&n.callbackHandlers.onStartProcessing(e,t)})),I(this,"cancel",(function(){n.xhr&&(n.xhr.abort(),n.callbackHandlers.onCancel&&n.callbackHandlers.onCancel(n.uploadId||""))})),this.media=t.media,this.vipType=t.vipType,this.maxUploadAttempts=t.maxUploadAttempts||1,this.numAttempts=0,this.callbackHandlers=t.callbackHandlers},M=function(e){f(n,e);var t=m(n);function n(e){var a;return b(this,n),I(v(a=t.call(this,e)),"getClassName",(function(){return"ImageUpload"})),I(v(a),"onProcessingFailed",(function(e){a.uploadId&&a.onFailure(a.uploadId,"Failed to process image with uploadId ".concat(a.uploadId," and failureCode ").concat(e),3)})),I(v(a),"onProcessingTimeout",(function(){a.uploadId&&a.onFailure(a.uploadId,"Timed out on processing video with uploadId ".concat(a.uploadId),11)})),I(v(a),"upload",(function(){"localImage"===a.media.type&&(a.numAttempts+=1,l(Object(d.a)(a.media.src),"image",a.vipType,{onFailure:a.onFailure,onFinishUpload:a.onFinishUpload,onStartUpload:a.callbackHandlers.onStartUpload,onUploadProgress:a.callbackHandlers.onUploadProgress}).then((function(e){a.uploadId=e.uploadId,a.xhr=e.xhr,a.status="uploading"})).catch((function(e){a.status="failed",a.onFailure(null,"Failed to register upload with message: ".concat(e),13)})))})),a.signature=P.includes(e.media.type)?e.media.signature:null,a.status=P.includes(e.media.type)?"uploaded":"pending",a}return n}(S),E=function(e){f(n,e);var t=m(n);function n(e){var a;return b(this,n),I(v(a=t.call(this,e)),"getClassName",(function(){return"VideoUpload"})),I(v(a),"onProcessingFailed",(function(e){a.uploadId&&a.onFailure(a.uploadId,"Failed to process video with uploadId ".concat(a.uploadId," and failureCode ").concat(e),10)})),I(v(a),"onProcessingTimeout",(function(){a.uploadId&&a.onFailure(a.uploadId,"Timed out on processing video with uploadId ".concat(a.uploadId),11)})),I(v(a),"upload",(function(){"localVideo"===a.media.type&&(a.numAttempts+=1,l(a.media.fileSrc,"video",a.vipType,{onFailure:a.onFailure,onFinishUpload:a.onFinishUpload,onStartUpload:a.callbackHandlers.onStartUpload,onUploadProgress:a.callbackHandlers.onUploadProgress}).then((function(e){a.uploadId=e.uploadId,a.xhr=e.xhr,a.status="uploading"})).catch((function(e){a.status="failed",a.onFailure(null,"Failed to register upload with message: ".concat(e),7)})))})),a.signature=P.includes(e.media.type)?e.media.signature:null,a.status=P.includes(e.media.type)?"uploaded":"pending",a}return n}(S);function O(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?O(Object(n),!0).forEach((function(t){T(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function T(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var U=function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),T(this,"checkAllUploadsProcessingOrCompleted",(function(){for(var e=0,t=0,a=Object.keys(n.mediaUploadsMap);t<a.length;t++){var r=a[t],o=n.mediaUploadsMap[r];n.inDebugMode&&console.log("[MEDIA UPLOAD MANAGER] - Status of media upload ID",r,o.mediaUpload.getClassName(),o.status),("completed"===o.status||"processing"===o.status&&"VideoUpload"===o.mediaUpload.getClassName())&&(e+=1)}return n.inDebugMode&&(console.log("[MEDIA UPLOAD MANAGER] - Checking if all upload processes completed"),console.log("Number of completed uploads:",e)),e===Object.keys(n.mediaUploadsMap).length})),T(this,"checkUploadsFailed",(function(){return!!Object.keys(n.mediaUploadsMap).find((function(e){return"failed"===n.mediaUploadsMap[e].status}))})),T(this,"updateUploadStatus",(function(e,t){return n.mediaUploadsMap[e].status=t})),T(this,"updateVIPStatusMap",(function(e){for(var t=new Date,a=0,r=Object.keys(e);a<r.length;a++){var o=r[a],i=e[o],u=i.failureCode,s=i.signature,l=i.status;if(o in n.vipStatusMap){var c=n.vipStatusMap[o].mediaId,d=n.mediaUploadsMap[c];if(u){d.mediaUpload.onProcessingFailed(u),n.updateUploadStatus(c,"failed");break}if(n.vipStatusMap[o].status!==l){if(n.vipStatusMap[o]=_(_({},n.vipStatusMap[o]),{},{status:l,timeSet:t}),"processing"===l)d.mediaUpload.onStartProcessing(o,{signature:s}),n.updateUploadStatus(c,"processing");else if("succeeded"===l){var p=(t-n.vipStatusMap[o].timeSet)/1e3;d.mediaUpload.onFinishProcessing(o,{processingTimeSec:p,signature:s}),n.updateUploadStatus(c,"completed")}}else n.statusTimeoutMap[l]&&(t-n.vipStatusMap[o].timeSet)/1e3>=n.statusTimeoutMap[l].timeoutSec&&(d.mediaUpload.onProcessingTimeout(),n.statusTimeoutMap[l].onTimeout())}}})),T(this,"handleFailure",(function(e,t){n.failed||(n.onFailure(e,t),n.failed=!0)})),T(this,"handleCheckUploadsCompleted",(function(){var e=n.checkAllUploadsProcessingOrCompleted();return e&&n.onCompleted&&!n.completed&&(n.inDebugMode&&console.log("[MEDIA UPLOAD MANAGER] - All uploads have completed & we are triggering the onCompleted callback"),n.completed=!0,n.onCompleted()),e})),T(this,"onFinishUpload",(function(e,t){n.vipStatusMap[e]={mediaId:t,status:null,timeSet:new Date},n.updateUploadStatus(t,"uploaded"),n.inDebugMode&&console.log("[MEDIA UPLOAD MANAGER] Finished uploading media ID",t),n.checkingStatus||(n.checkingStatus=!0,setTimeout((function(){return n.checkStatus()}),2e3))})),T(this,"onUploadFailed",(function(e,t,a){n.updateUploadStatus(e,"failed"),n.handleFailure(t,a),n.inDebugMode&&console.log("[MEDIA UPLOAD MANAGER] Failed uploading media ID",e)})),T(this,"removeMediaUpload",(function(e){n.mediaUploadsMap[e]&&(n.mediaUploadsMap[e].mediaUpload.cancel(),delete n.mediaUploadsMap[e])})),T(this,"addMediaUpload",(function(e,t,a,r){var o=_(_({},r),{},{onFailure:function(e,a,o){n.onUploadFailed(t,a,o),r.onFailure(e,a,o)},onFinishUpload:function(e,a){n.onFinishUpload(e,t),r.onFinishUpload&&r.onFinishUpload(e,a)}}),i="localImage"===e.type||"webImage"===e.type?new M({callbackHandlers:o,media:e,maxUploadAttempts:n.maxMediaUploadAttempts,vipType:"pinimage"}):new E({callbackHandlers:o,media:e,maxUploadAttempts:n.maxMediaUploadAttempts,vipType:"video-story-pin"});if(n.mediaUploadsMap[t]){n.mediaUploadsMap[t].mediaUpload.cancel();var u=n.mediaUploadsMap[t].mediaUpload.uploadId;u&&u in n.vipStatusMap&&delete n.vipStatusMap[u]}n.inDebugMode&&console.log("[MEDIA UPLOAD MANAGER] Added media ID to upload",t),n.mediaUploadsMap[t]={mediaUpload:i,status:"pending"},i.upload(),n.updateUploadStatus(t,"uploading")})),T(this,"reset",(function(){n.failed=!1,n.statusCheckFailureCount=0,n.completed=!1})),T(this,"cancelAll",(function(){for(var e=0,t=Object.keys(n.mediaUploadsMap);e<t.length;e++){var a=t[e];"uploading"===n.mediaUploadsMap[a].status&&n.mediaUploadsMap[a].mediaUpload.cancel()}})),T(this,"checkStatus",(function(){if(n.checkUploadsFailed())return n.checkingStatus=!1,void(n.inDebugMode&&console.log("[MEDIA UPLOAD MANAGER] There is a failure in check status",n.vipStatusMap));n.inDebugMode&&console.log("[MEDIA UPLOAD MANAGER] Checking status",n.vipStatusMap),n.checkingStatus=!0,function(e){return s.apply(this,arguments)}(Object.keys(n.vipStatusMap)).then((function(e){n.inDebugMode&&console.log("[MEDIA UPLOAD MANAGER] Check status response received",n.vipStatusMap),n.updateVIPStatusMap(e);for(var t=n.handleCheckUploadsCompleted(),a=0,r=Object.keys(n.vipStatusMap);a<r.length;a++){var o=r[a],i=n.vipStatusMap[o].mediaId;"completed"===n.mediaUploadsMap[i].status&&delete n.vipStatusMap[o]}Object.keys(n.vipStatusMap).length>0&&!t?setTimeout((function(){return n.checkStatus()}),2e3):n.checkingStatus=!1})).catch((function(e){n.statusCheckFailureCount+=1,n.statusCheckFailureCount>2?(n.inDebugMode&&console.log("[MEDIA UPLOAD MANAGER] - Failing upload because status check failed ".concat(n.statusCheckFailureCount," times")),n.handleFailure("Could not check VIP status",14),n.checkingStatus=!1):(n.inDebugMode&&console.log("[MEDIA UPLOAD MANAGER] - Continuing upload because status check only failed ".concat(n.statusCheckFailureCount," times")),setTimeout((function(){return n.checkStatus()}),2e3))}))})),this.onCancel=t.onCancel,this.onCompleted=t.onCompleted||null,this.onFailure=t.onFailure,this.statusTimeoutMap=t.statusTimeoutMap,this.maxMediaUploadAttempts=t.maxMediaUploadAttempts,this.inDebugMode=t.inDebugMode,this.checkingStatus=!1,this.completed=!1,this.failed=!1,this.statusCheckFailureCount=0,this.mediaUploadsMap={},this.vipStatusMap={}}}}]);
//# sourceMappingURL=https://sm.pinimg.com/webapp/js/111-cef30a86089dcbecfa05.js.map